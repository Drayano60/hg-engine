.include "asm/include/battle_commands.inc"

.data

_000:
    PrintAttackMessage 
    Wait 
    PlayMoveAnimation BATTLER_CATEGORY_ATTACKER
    Wait

_ReflectPlayerSide:
    CheckSideCondition BATTLER_CATEGORY_PLAYER, CHECK_SIDE_COND_VAL_ZERO, SIDE_COND_REFLECT_TURNS, _ReflectOpposingSide
    CheckSideCondition BATTLER_CATEGORY_PLAYER, CHECK_SIDE_COND_CLEAR, SIDE_COND_REFLECT_TURNS, _ReflectOpposingSide
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_REFLECT
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_ReflectOpposingSide:
    CheckSideCondition BATTLER_CATEGORY_ENEMY, CHECK_SIDE_COND_VAL_ZERO, SIDE_COND_REFLECT_TURNS, _LightScreenPlayerSide
    CheckSideCondition BATTLER_CATEGORY_ENEMY, CHECK_SIDE_COND_CLEAR, SIDE_COND_REFLECT_TURNS, _LightScreenPlayerSide
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_REFLECT
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_LightScreenPlayerSide:
    CheckSideCondition BATTLER_CATEGORY_PLAYER, CHECK_SIDE_COND_VAL_ZERO, SIDE_COND_LIGHT_SCREEN_TURNS, _LightScreenOpposingSide
    CheckSideCondition BATTLER_CATEGORY_PLAYER, CHECK_SIDE_COND_CLEAR, SIDE_COND_LIGHT_SCREEN_TURNS, _LightScreenOpposingSide
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_LIGHT_SCREEN
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_LightScreenOpposingSide:
    CheckSideCondition BATTLER_CATEGORY_ENEMY, CHECK_SIDE_COND_VAL_ZERO, SIDE_COND_LIGHT_SCREEN_TURNS, _SpikesPlayerSide
    CheckSideCondition BATTLER_CATEGORY_ENEMY, CHECK_SIDE_COND_CLEAR, SIDE_COND_LIGHT_SCREEN_TURNS, _SpikesPlayerSide
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_LIGHT_SCREEN
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_SpikesPlayerSide:
    CheckSideCondition BATTLER_CATEGORY_PLAYER, CHECK_SIDE_COND_VAL_ZERO, SIDE_COND_SPIKES_LAYERS, _SpikesOpposingSide
    CheckSideCondition BATTLER_CATEGORY_PLAYER, CHECK_SIDE_COND_CLEAR, SIDE_COND_SPIKES_LAYERS, _SpikesOpposingSide
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_SPIKES
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_SpikesOpposingSide:
    CheckSideCondition BATTLER_CATEGORY_ENEMY, CHECK_SIDE_COND_VAL_ZERO, SIDE_COND_SPIKES_LAYERS, _ToxicSpikesPlayerSide
    CheckSideCondition BATTLER_CATEGORY_ENEMY, CHECK_SIDE_COND_CLEAR, SIDE_COND_SPIKES_LAYERS, _ToxicSpikesPlayerSide
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_SPIKES
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_ToxicSpikesPlayerSide:
    CheckSideCondition BATTLER_CATEGORY_PLAYER, CHECK_SIDE_COND_VAL_ZERO, SIDE_COND_TOXIC_SPIKES_LAYERS, _ToxicSpikesOpposingSide
    CheckSideCondition BATTLER_CATEGORY_PLAYER, CHECK_SIDE_COND_CLEAR, SIDE_COND_TOXIC_SPIKES_LAYERS, _ToxicSpikesOpposingSide
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_TOXIC_SPIKES
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_ToxicSpikesOpposingSide:
    CheckSideCondition BATTLER_CATEGORY_ENEMY, CHECK_SIDE_COND_VAL_ZERO, SIDE_COND_TOXIC_SPIKES_LAYERS, _StealthRockPlayerSide
    CheckSideCondition BATTLER_CATEGORY_ENEMY, CHECK_SIDE_COND_CLEAR, SIDE_COND_TOXIC_SPIKES_LAYERS, _StealthRockPlayerSide
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_TOXIC_SPIKES
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_StealthRockPlayerSide:
    CompareVarToValue OPCODE_FLAG_NOT, BSCRIPT_VAR_SIDE_CONDITION_ATTACKER, SIDE_CONDITION_STEALTH_ROCKS, _StealthRockOpposingSide
    UpdateVar OPCODE_FLAG_OFF, BSCRIPT_VAR_SIDE_CONDITION_ATTACKER, SIDE_CONDITION_STEALTH_ROCKS
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_STEALTH_ROCK
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_StealthRockOpposingSide:
    CompareVarToValue OPCODE_FLAG_NOT, BSCRIPT_VAR_SIDE_CONDITION_TARGET, SIDE_CONDITION_STEALTH_ROCKS, _ClearPlayerLeftSubstitute
    UpdateVar OPCODE_FLAG_OFF, BSCRIPT_VAR_SIDE_CONDITION_TARGET, SIDE_CONDITION_STEALTH_ROCKS
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_STEALTH_ROCK
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_ClearPlayerLeftSubstitute:
    CompareMonDataToValue OPCODE_FLAG_NOT, BATTLER_CATEGORY_PLAYER_SLOT_1, BMON_DATA_STATUS2, STATUS2_SUBSTITUTE, _ClearPlayerRightSubstitute
    UpdateMonData OPCODE_FLAG_OFF, BATTLER_CATEGORY_PLAYER_SLOT_1, BMON_DATA_STATUS2, STATUS2_SUBSTITUTE
    PlayBattleAnimation BATTLER_CATEGORY_PLAYER_SLOT_1, BATTLE_ANIMATION_SUBSTITUTE_OUT
    Wait 
    RestoreSprite BATTLER_CATEGORY_PLAYER_SLOT_1
    Wait 
    PlayBattleAnimation BATTLER_CATEGORY_PLAYER_SLOT_1, BATTLE_ANIMATION_SUB_IN
    Wait 
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_SUBSTITUTE
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_ClearPlayerRightSubstitute:
    CompareMonDataToValue OPCODE_FLAG_NOT, BATTLER_CATEGORY_PLAYER_SLOT_2, BMON_DATA_STATUS2, STATUS2_SUBSTITUTE, _ClearOpposingLeftSubstitute
    UpdateMonData OPCODE_FLAG_OFF, BATTLER_CATEGORY_PLAYER_SLOT_2, BMON_DATA_STATUS2, STATUS2_SUBSTITUTE
    PlayBattleAnimation BATTLER_CATEGORY_PLAYER_SLOT_2, BATTLE_ANIMATION_SUBSTITUTE_OUT
    Wait 
    RestoreSprite BATTLER_CATEGORY_PLAYER_SLOT_2
    Wait 
    PlayBattleAnimation BATTLER_CATEGORY_PLAYER_SLOT_2, BATTLE_ANIMATION_SUB_IN
    Wait 
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_SUBSTITUTE
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_ClearOpposingLeftSubstitute:
    CompareMonDataToValue OPCODE_FLAG_NOT, BATTLER_CATEGORY_ENEMY_SLOT_1, BMON_DATA_STATUS2, STATUS2_SUBSTITUTE, _ClearOpposingRightSubstitute
    UpdateMonData OPCODE_FLAG_OFF, BATTLER_CATEGORY_ENEMY_SLOT_1, BMON_DATA_STATUS2, STATUS2_SUBSTITUTE
    PlayBattleAnimation BATTLER_CATEGORY_ENEMY_SLOT_1, BATTLE_ANIMATION_SUBSTITUTE_OUT
    Wait 
    RestoreSprite BATTLER_CATEGORY_ENEMY_SLOT_1
    Wait 
    PlayBattleAnimation BATTLER_CATEGORY_ENEMY_SLOT_1, BATTLE_ANIMATION_SUB_IN
    Wait 
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_SUBSTITUTE
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_ClearOpposingRightSubstitute:
    CompareMonDataToValue OPCODE_FLAG_NOT, BATTLER_CATEGORY_ENEMY_SLOT_2, BMON_DATA_STATUS2, STATUS2_SUBSTITUTE, _TidyUpMessage
    UpdateMonData OPCODE_FLAG_OFF, BATTLER_CATEGORY_ENEMY_SLOT_2, BMON_DATA_STATUS2, STATUS2_SUBSTITUTE
    PlayBattleAnimation BATTLER_CATEGORY_ENEMY_SLOT_2, BATTLE_ANIMATION_SUBSTITUTE_OUT
    Wait 
    RestoreSprite BATTLER_CATEGORY_ENEMY_SLOT_2
    Wait 
    PlayBattleAnimation BATTLER_CATEGORY_ENEMY_SLOT_2, BATTLE_ANIMATION_SUB_IN
    Wait 
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MSG_MOVE_TEMP, MOVE_SUBSTITUTE
    Call BATTLE_SUBSCRIPT_DEFOG_MESSAGE

_TidyUpMessage:
    // Tidying up complete!
    PrintMessage 2061, TAG_NONE
    Wait 
    WaitButtonABTime 30
    CompareMonDataToValue OPCODE_NEQ, BATTLER_CATEGORY_SIDE_EFFECT_MON, BMON_DATA_STAT_CHANGE_ATK, 12, _StatBoost
    CompareMonDataToValue OPCODE_EQU, BATTLER_CATEGORY_SIDE_EFFECT_MON, BMON_DATA_STAT_CHANGE_SPEED, 12, _StatBoostFailed

_StatBoost:
    Call BATTLE_SUBSCRIPT_ATTACK_MESSAGE_AND_ANIMATION
    UpdateVar OPCODE_FLAG_ON, BSCRIPT_VAR_BATTLE_STATUS, BATTLE_STATUS_MESSAGES_OFF
    UpdateVar OPCODE_FLAG_ON, BSCRIPT_VAR_BATTLE_STATUS, BATTLE_STATUS_MOVE_ANIMATIONS_OFF|BATTLE_STATUS_NO_ATTACK_MESSAGE
    UpdateVar OPCODE_FLAG_ON, BSCRIPT_VAR_BATTLE_STATUS_2, BATTLE_STATUS2_STAT_STAGE_CHANGE_SHOWN
    UpdateVar OPCODE_SET, BSCRIPT_VAR_SIDE_EFFECT_PARAM, MOVE_SUBSCRIPT_PTR_ATTACK_UP_1_STAGE
    Call BATTLE_SUBSCRIPT_UPDATE_STAT_STAGE
    UpdateVar OPCODE_SET, BSCRIPT_VAR_SIDE_EFFECT_PARAM, MOVE_SUBSCRIPT_PTR_SPEED_UP_1_STAGE
    Call BATTLE_SUBSCRIPT_UPDATE_STAT_STAGE
    UpdateVar OPCODE_FLAG_OFF, BSCRIPT_VAR_BATTLE_STATUS_2, BATTLE_STATUS2_UPDATE_STAT_STAGES
    UpdateVar OPCODE_FLAG_OFF, BSCRIPT_VAR_BATTLE_STATUS_2, BATTLE_STATUS2_STAT_STAGE_CHANGE_SHOWN
    End 

_StatBoostFailed:
    // {0}’s stats won’t go any higher!
    PrintMessage 768, TAG_NICKNAME, BATTLER_CATEGORY_SIDE_EFFECT_MON
    Wait 
    WaitButtonABTime 30
    UpdateVar OPCODE_FLAG_ON, BSCRIPT_VAR_MOVE_STATUS_FLAGS, MOVE_STATUS_NO_MORE_WORK
    End 
